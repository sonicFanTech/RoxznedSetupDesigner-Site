
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="theme-color" content="#141414">
  <title>Roxzned Setup Designer — Web Demo</title>
  <style>
    :root{
      /* Match the dark Qt-ish look from your screenshots */
      --bg: #1a1a1a;
      --panel: #202020;
      --panel2:#262626;
      --panel3:#2c2c2c;
      --border:#3a3a3a;
      --border2:#454545;
      --text:#eaeaea;
      --muted:#bdbdbd;
      --faint:#8f8f8f;
      --accent:#2aa9ff;
      --accent2:#00c7b7;
      --shadow: 0 18px 60px rgba(0,0,0,.55);

      --font: "Segoe UI", system-ui, -apple-system, Roboto, Arial, sans-serif;
      --mono: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;

      --r: 8px;
      --r2: 10px;

      --menubar-h: 30px;
      --toolbar-h: 42px;
    }

    *{ box-sizing:border-box; }
    html,body{ height:100%; }
    body{
      margin:0;
      background:#0f0f0f;
      color:var(--text);
      font-family:var(--font);
    }

    /* App frame */
    .app{
      min-height:100vh;
      background: linear-gradient(#1b1b1b, #181818);
    }

    /* Top menu bar */
    .menubar{
      height:var(--menubar-h);
      display:flex;
      align-items:center;
      gap:14px;
      padding:0 10px;
      background:#171717;
      border-bottom:1px solid #2a2a2a;
      user-select:none;
    }
    .menu{
      position:relative;
      padding:4px 8px;
      border-radius:6px;
      color:#f1f1f1;
      font-size:13px;
      cursor:pointer;
    }
    .menu:hover{ background:#232323; }
    .menu.open{ background:#262626; outline:1px solid #303030; }
    .dropdown{
      position:absolute;
      top:calc(var(--menubar-h) - 2px);
      left:0;
      min-width:190px;
      background:#1f1f1f;
      border:1px solid #3b3b3b;
      border-radius:8px;
      box-shadow:var(--shadow);
      padding:6px;
      display:none;
      z-index:30;
    }
    .menu.open .dropdown{ display:block; }
    .dd-item{
      display:flex;
      justify-content:space-between;
      gap:14px;
      padding:7px 8px;
      border-radius:6px;
      color:#eaeaea;
      font-size:13px;
      cursor:pointer;
    }
    .dd-item:hover{ background:#2a2a2a; }
    .dd-sep{ height:1px; background:#343434; margin:6px 4px; }
    .dd-kbd{ color:#9e9e9e; font-family:var(--mono); font-size:12px; }

    /* Toolbar */
    .toolbar{
      height:var(--toolbar-h);
      display:flex;
      align-items:center;
      gap:10px;
      padding:0 10px;
      background:#1b1b1b;
      border-bottom:1px solid #2d2d2d;
    }
    .toolIcon{
      width:26px; height:26px;
      border:1px solid #2f2f2f;
      background:linear-gradient(#1f1f1f, #191919);
      border-radius:6px;
      display:grid;
      place-items:center;
      cursor:pointer;
    }
    .toolIcon:hover{ border-color:#3b3b3b; background:linear-gradient(#242424,#1b1b1b); }
    .toolLink{
      margin-left:6px;
      color:#d8d8d8;
      font-size:13px;
      cursor:pointer;
    }
    .toolLink:hover{ color:#ffffff; text-decoration:underline; }

    /* Main layout */
    .main{
      height:calc(100vh - var(--menubar-h) - var(--toolbar-h));
      display:grid;
      grid-template-columns: 1.35fr .65fr;
      gap:0;
    }
    .leftArea{ border-right:1px solid #2d2d2d; background:#161616; overflow:auto; }
    .rightArea{ background:#141414; overflow:hidden; }

    /* Left content */
    .sectionTitle{
      padding:10px 12px 6px;
      font-size:13px;
      color:#eaeaea;
    }
    .sectionTitle .sub{ color:#9d9d9d; font-size:12px; margin-top:2px; }

    .panel{
      margin:0 10px 10px;
      background: #1b1b1b;
      border:1px solid #303030;
      border-radius:8px;
      overflow:hidden;
    }
    .panelHeader{
      padding:8px 10px;
      background: #202020;
      border-bottom:1px solid #2f2f2f;
      font-size:13px;
      color:#eaeaea;
      display:flex;
      align-items:center;
      justify-content:space-between;
    }
    .panelBody{ padding:10px; }

    .gridForm{
      display:grid;
      grid-template-columns: 160px 1fr 92px;
      gap:8px 10px;
      align-items:center;
    }
    .lbl{ color:#d9d9d9; font-size:13px; }

    .in, .ta, .sel{
      width:100%;
      background:#111;
      color:#f0f0f0;
      border:1px solid #3a3a3a;
      border-radius:6px;
      padding:6px 8px;
      font-size:13px;
      outline:none;
    }
    .in:focus, .ta:focus, .sel:focus{ border-color:#4a4a4a; box-shadow:0 0 0 2px rgba(42,169,255,.12); }

    .ta{
      min-height:92px;
      resize:vertical;
      font-family:var(--font);
      line-height:1.35;
    }

    .btn{
      background:linear-gradient(#2b2b2b,#232323);
      border:1px solid #3e3e3e;
      color:#f1f1f1;
      border-radius:6px;
      padding:6px 10px;
      font-size:13px;
      cursor:pointer;
      user-select:none;
    }
    .btn:hover{ border-color:#4a4a4a; background:linear-gradient(#303030,#262626); }
    .btn:active{ transform: translateY(1px); }

    .btn.primary{
      border-color:rgba(42,169,255,.55);
      background:linear-gradient(rgba(42,169,255,.18), rgba(42,169,255,.08));
    }

    .splitRow{
      display:grid;
      grid-template-columns: 220px 1fr;
      gap:10px;
      margin:0 10px 10px;
    }

    /* Pages list area */
    .listBox{
      height:280px;
      background:#101010;
      border:1px solid #3a3a3a;
      border-radius:6px;
      overflow:auto;
      padding:4px;
    }
    .pageItem{
      padding:6px 8px;
      border-radius:5px;
      cursor:pointer;
      font-size:13px;
      color:#e6e6e6;
      border:1px solid transparent;
    }
    .pageItem:hover{ background:#232323; }
    .pageItem.active{
      background:#2a2a2a;
      border-color:#3c3c3c;
      box-shadow: inset 0 0 0 1px rgba(42,169,255,.18);
    }
    .rowBtns{ display:flex; gap:8px; padding-top:8px; flex-wrap:wrap; }

    .designerOptions{
      margin:0 10px 10px;
      padding:8px 10px;
      border:1px solid #303030;
      border-radius:8px;
      background:#1b1b1b;
      display:flex;
      align-items:center;
      gap:10px;
    }
    .chk{ display:flex; align-items:center; gap:8px; color:#eaeaea; font-size:13px; }
    input[type="checkbox"]{ width:15px; height:15px; accent-color: var(--accent2); }

    /* Canvas + page settings */
    .pageBar{
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:10px;
      padding-bottom:8px;
    }
    .pageBar .mini{
      display:flex;
      align-items:center;
      gap:10px;
      flex-wrap:wrap;
    }
    .tinyLbl{ color:#cfcfcf; font-size:13px; }

    .canvasWrap{
      height: 360px;
      border:1px solid #3a3a3a;
      border-radius:6px;
      background:#121212;
      position:relative;
      overflow:hidden;
    }
    .gridOn{
      background-image:
        linear-gradient(to right, rgba(255,255,255,.08) 1px, transparent 1px),
        linear-gradient(to bottom, rgba(255,255,255,.08) 1px, transparent 1px);
      background-size: 20px 20px;
    }

    .widget{
      position:absolute;
      padding:6px 8px;
      border-radius:4px;
      border:1px solid transparent;
      cursor:move;
      user-select:none;
      color:#f2f2f2;
      font-size:13px;
      background: rgba(0,0,0,.18);
    }
    .widget.btnW{
      background: linear-gradient(#2b2b2b,#232323);
      border:1px solid #3e3e3e;
      cursor:pointer;
      padding:6px 10px;
    }
    .widget.imgW{
      background: rgba(255,255,255,.06);
      border:1px solid #3a3a3a;
    }
    .widget.selected{
      border-color: rgba(42,169,255,.7);
      box-shadow: 0 0 0 2px rgba(42,169,255,.18);
    }

    /* Right: Code editor */
    .codeShell{
      height:100%;
      display:flex;
      flex-direction:column;
      border-left:1px solid #2d2d2d;
    }
    .codeTop{
      padding:8px 10px;
      background:#1b1b1b;
      border-bottom:1px solid #2d2d2d;
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:10px;
    }
    .codeTop .title{ font-size:13px; color:#eaeaea; }
    .chip{
      font-size:12px;
      color:#cfcfcf;
      background:#232323;
      border:1px solid #353535;
      padding:4px 8px;
      border-radius:999px;
    }

    .codeArea{
      flex:1;
      overflow:auto;
      background:#141414;
    }
    .codeRow{
      display:grid;
      grid-template-columns: 52px 1fr;
      font-family:var(--mono);
      font-size:12.5px;
      line-height:1.55;
      min-height:100%;
    }
    .ln{
      padding:10px 10px;
      color:#8d8d8d;
      border-right:1px solid #2b2b2b;
      background:#151515;
      text-align:right;
      white-space:pre;
      user-select:none;
    }
    .code{
      padding:10px 12px;
      color:#eaeaea;
      white-space:pre;
    }

    /* Modal window (PyInstaller builder) */
    .modalBack{
      position:fixed;
      inset:0;
      background: rgba(0,0,0,.55);
      display:none;
      align-items:center;
      justify-content:center;
      z-index:80;
    }
    .modal{
      width:min(760px, calc(100vw - 26px));
      border-radius:10px;
      border:1px solid #4a4a4a;
      background:#1d1d1d;
      box-shadow:var(--shadow);
      overflow:hidden;
    }
    .modalTitle{
      padding:8px 10px;
      background: linear-gradient(#2a4f63, #1f3642);
      color:#eaf6ff;
      border-bottom:1px solid #1b2c33;
      font-size:13px;
      display:flex;
      align-items:center;
      justify-content:space-between;
    }
    .modalBody{ padding:10px; }
    .modalFooter{
      padding:10px;
      display:flex;
      justify-content:flex-end;
      gap:10px;
      border-top:1px solid #2d2d2d;
      background:#1a1a1a;
    }

    .modalForm{
      display:grid;
      grid-template-columns: 130px 1fr 92px;
      gap:8px 10px;
      align-items:center;
    }
    .logBox{
      margin-top:10px;
      height:260px;
      border:1px solid #3a3a3a;
      border-radius:6px;
      background:#2b2b2b;
      overflow:auto;
      padding:8px;
      color:#eaeaea;
      font-family:var(--mono);
      font-size:12px;
      white-space:pre;
    }

    /* Toast */
    .toast{
      position:fixed;
      right:14px;
      bottom:14px;
      padding:10px 12px;
      border:1px solid #3c3c3c;
      border-radius:10px;
      background:#1e1e1e;
      color:#f0f0f0;
      box-shadow:var(--shadow);
      display:none;
      max-width:min(420px, calc(100vw - 28px));
      font-size:13px;
      z-index:120;
    }
    .toast b{ color:#ffffff; }

    /* Wizard maker hidden mode */
    .wizardHidden .leftArea{ display:none; }
    .wizardHidden .main{ grid-template-columns: 1fr; }

    /* Light mode toggle (just for demo) */
    .lightMode{
      filter: invert(1) hue-rotate(180deg);
    }
    .lightMode img{ filter: invert(1) hue-rotate(180deg); }

    /* Make it usable on smaller screens */
    @media (max-width: 1100px){
      .main{ grid-template-columns: 1fr; }
      .leftArea{ border-right:none; border-bottom:1px solid #2d2d2d; }
      .rightArea{ height: 46vh; }
    }
  </style>


  <div class="app" id="appRoot" style="transform: scale(1); transform-origin: left top;">

    <!-- Menu bar -->
    <div class="menubar" id="menubar">
      <div class="menu open" data-menu="file">File
        <div class="dropdown">
          <div class="dd-item" data-act="newProject">New Project<span class="dd-kbd">Ctrl+N</span></div>
          <div class="dd-item" data-act="openProject">Open Project…<span class="dd-kbd">Ctrl+O</span></div>
          <div class="dd-item" data-act="saveProject">Save Project<span class="dd-kbd">Ctrl+S</span></div>
          <div class="dd-sep"></div>
          <div class="dd-item" data-act="exportInstaller">Export Installer Code…<span class="dd-kbd">Ctrl+E</span></div>
          <div class="dd-item" data-act="exportUninstaller">Export Uninstaller Code…<span class="dd-kbd">Ctrl+Shift+E</span></div>
          <div class="dd-sep"></div>
		  <a class="dd-item" href="index.html">Close Demo</a>
        </div>
      </div>

      <div class="menu" data-menu="edit">Edit
        <div class="dropdown">
          <div class="dd-item" data-act="undo">Undo<span class="dd-kbd">Ctrl+Z</span></div>
          <div class="dd-item" data-act="redo">Redo<span class="dd-kbd">Ctrl+Y</span></div>
          <div class="dd-sep"></div>
          <div class="dd-item" data-act="addWidget">Add Widget…<span class="dd-kbd">Ins</span></div>
          <div class="dd-item" data-act="deleteWidget">Delete Widget<span class="dd-kbd">Del</span></div>
        </div>
      </div>

      <div class="menu" data-menu="view">View
        <div class="dropdown">
          <div class="dd-item" data-act="toggleLineNumbers">Toggle Line Numbers<span class="dd-kbd">Ctrl+L</span></div>
          <div class="dd-item" data-act="toggleGrid">Toggle Grid<span class="dd-kbd">Ctrl+G</span></div>
          <div class="dd-sep"></div>
          <div class="dd-item" data-act="zoomIn">Zoom In<span class="dd-kbd">Ctrl++</span></div>
          <div class="dd-item" data-act="zoomOut">Zoom Out<span class="dd-kbd">Ctrl+-</span></div>
          <div class="dd-item" data-act="resetZoom">Reset Zoom<span class="dd-kbd">Ctrl+0</span></div>
        </div>
      </div>

      <div class="menu" data-menu="tools">Tools
        <div class="dropdown">
          <div class="dd-item" data-act="toggleWizard">Toggle Wizard Maker<span class="dd-kbd">Ctrl+W</span></div>
          <div class="dd-item" data-act="toggleDark">Toggle Dark Mode<span class="dd-kbd">Ctrl+D</span></div>
          <div class="dd-sep"></div>
          <div class="dd-item" data-act="build">Build (PyInstaller)…<span class="dd-kbd">Ctrl+B</span></div>
        </div>
      </div>

      <div class="menu" data-menu="help">Help
        <div class="dropdown">
          <div class="dd-item" data-act="help">Help Doc<span class="dd-kbd">F1</span></div>
          <div class="dd-item" data-act="about">About<span class="dd-kbd">—</span></div>
        </div>
      </div>
    </div>

    <!-- Toolbar row -->
    <div class="toolbar">
      <div class="toolIcon" title="Save"><svg width="16" height="16" viewBox="0 0 24 24" fill="none"><path d="M5 4h11l3 3v13H5V4Z" stroke="#cfcfcf" stroke-width="1.6"></path><path d="M8 4v6h8V4" stroke="#cfcfcf" stroke-width="1.6"></path><path d="M8 20v-6h8v6" stroke="#cfcfcf" stroke-width="1.6"></path></svg></div>
      <div class="toolIcon" title="Open"><svg width="16" height="16" viewBox="0 0 24 24" fill="none"><path d="M4 19V6h6l2 2h8v11H4Z" stroke="#cfcfcf" stroke-width="1.6"></path></svg></div>
      <div class="toolIcon" title="Build" id="buildBtn"><svg width="16" height="16" viewBox="0 0 24 24" fill="none"><path d="M12 2l3 6 7 1-5 5 1 7-6-3-6 3 1-7-5-5 7-1 3-6Z" stroke="#7fd7ff" stroke-width="1.6"></path></svg></div>
      <div class="toolLink" id="buildLink">Build (PyInstaller)…</div>
    </div>

    <!-- Main -->
    <div class="main" id="main">

      <!-- LEFT: Wizard Maker / Designer -->
      <div class="leftArea">
        <div class="sectionTitle">Setup Wizard Maker</div>

        <div class="panel" id="projectPanel">
          <div class="panelHeader">
            <span>Project Settings</span>
            <span class="sub" style="color:#9d9d9d; font-size:12px;">Roxzned Setup Designer (demo)</span>
          </div>
          <div class="panelBody">
            <div class="gridForm">
              <div class="lbl">App name:</div>
              <input class="in" id="appName" value="Vidplayer">
              <div></div>

              <div class="lbl">Version:</div>
              <input class="in" id="appVer" value="2.0.9.1">
              <div></div>

              <div class="lbl">Publisher:</div>
              <input class="in" id="publisher" value="sonic Fan Tech">
              <div></div>

              <div class="lbl">Default install dir:</div>
              <input class="in" id="defaultDir" value="%LOCALAPPDATA%\\VidPlayer">
              <div></div>

              <div class="lbl">Source folder:</div>
              <input class="in" id="sourceFolder" value="E:/Projects/Project USB/VS Code/Python/Roxzned Setup installer Designer/Source/data">
              <button class="btn" data-act="browseSource">Browse…</button>

              <div class="lbl">Payload zip:</div>
              <input class="in" id="payloadZip" value="E:/Projects/Project USB/VS Code/Python/Roxzned Setup installer Designer/Source/payload.zip">
              <button class="btn" data-act="browsePayload">Browse…</button>
            </div>

            <div style="height:10px"></div>
            <div class="lbl" style="margin-bottom:6px;">License Text (used on License page role)</div>
            <textarea class="ta" id="licenseText">put EULA Here</textarea>
          </div>
        </div>

        <div class="splitRow">
          <!-- Pages list -->
          <div>
            <div class="panel" style="margin:0;">
              <div class="panelHeader">Pages</div>
              <div class="panelBody">
                <div class="listBox" id="pageList"><div class="pageItem">Welcome</div><div class="pageItem">License Agreement</div><div class="pageItem active">Choose Install Location</div><div class="pageItem">Installing</div><div class="pageItem">Finish</div></div>
                <div class="rowBtns">
                  <button class="btn" data-act="addPage">Add</button>
                  <button class="btn" data-act="dupPage">Duplicate</button>
                  <button class="btn" data-act="delPage">Delete</button>
                  <button class="btn" data-act="upPage">Up</button>
                  <button class="btn" data-act="downPage">Down</button>
                </div>
              </div>
            </div>

            <div class="designerOptions">
              <div class="sectionTitle" style="padding:0;">Designer Options</div>
              <label class="chk" style="margin-left:auto;">
                <input type="checkbox" id="showGrid" checked="">
                Show grid
              </label>
            </div>
          </div>

          <!-- Page editor + canvas + properties -->
          <div>
            <div class="panel" style="margin:0;">
              <div class="panelHeader">
                <span>Page Editor</span>
                <span style="color:#8f8f8f; font-size:12px;">Drag elements • Click to select</span>
              </div>
              <div class="panelBody">
                <div class="pageBar">
                  <div class="mini">
                    <span class="tinyLbl">Page title:</span>
                    <input class="in" id="pageTitle" style="width:220px">
                  </div>
                  <div class="mini">
                    <span class="tinyLbl">Role:</span>
                    <select class="sel" id="pageRole" style="width:170px">
                      <option value="welcome">welcome</option>
                      <option value="license">license</option>
                      <option value="path">path</option>
                      <option value="installing">installing</option>
                      <option value="finish">finish</option>
                      <option value="custom">custom</option>
                    </select>
                  </div>
                </div>

                <div class="gridForm" style="grid-template-columns: 160px 1fr 92px;">
                  <div class="lbl">Background color:</div>
                  <input class="in" id="bgColor" value="#151515">
                  <button class="btn" id="pickBg">Pick…</button>

                  <div class="lbl">Background image:</div>
                  <input class="in" id="bgImage" value="" placeholder="">
                  <button class="btn" data-act="browseBg">Browse…</button>
                </div>

                <div style="height:10px"></div>
                <div class="canvasWrap gridOn" id="canvas" style="background-color: rgb(21, 21, 21);"><div class="widget" data-id="w6" style="left: 24px; top: 24px; width: 420px; height: 24px; font-size: 10px; font-weight: 700; color: rgb(255, 255, 255);">Choose where you want to install the program:</div><div class="widget" data-id="w7" style="left: 24px; top: 60px; width: 420px; height: 26px; font-size: 10px; font-weight: 400; color: rgb(255, 255, 255); background: rgb(17, 17, 17); cursor: text;"><input value="%LOCALAPPDATA%\VidPlayer" style="width:100%; height:100%; background:#111; border:1px solid #3a3a3a; border-radius:4px; color:#f0f0f0; padding:4px 6px; font-family:var(--font); font-size:inherit;"></div><div class="widget btnW" data-id="w8" style="left: 454px; top: 60px; width: 92px; height: 26px; font-size: 10px; font-weight: 400; color: rgb(255, 255, 255); background: rgb(35, 35, 35);">Set Path</div><div class="widget" data-id="w9" style="left: 59px; top: 98px; width: 220px; height: 20px; font-size: 10px; font-weight: 400; color: rgb(255, 255, 255); cursor: pointer;"><label style="display:flex; align-items:center; gap:8px; cursor:pointer;">
              <input type="checkbox" checked="" style="accent-color: var(--accent2);">
              <span>Make Desktop shortcut</span>
            </label></div></div>

                <div style="height:10px"></div>

                <div class="panel" style="margin:0;">
                  <div class="panelHeader">Selected Widget Properties</div>
                  <div class="panelBody" id="props">
                    <div class="gridForm" style="grid-template-columns: 140px 1fr 92px;">
                      <div class="lbl">Type:</div>
                      <input class="in" id="wType" disabled="">
                      <div></div>

                      <div class="lbl">Name:</div>
                      <input class="in" id="wName" disabled="">
                      <div></div>

                      <div class="lbl">Text:</div>
                      <input class="in" id="wText" disabled="">
                      <div></div>

                      <div class="lbl">X:</div>
                      <input class="in" id="wX" type="number" disabled="">
                      <div></div>

                      <div class="lbl">Y:</div>
                      <input class="in" id="wY" type="number" disabled="">
                      <div></div>

                      <div class="lbl">W:</div>
                      <input class="in" id="wW" type="number" disabled="">
                      <div></div>

                      <div class="lbl">H:</div>
                      <input class="in" id="wH" type="number" disabled="">
                      <div></div>

                      <div class="lbl">Font size:</div>
                      <input class="in" id="wFont" type="number" disabled="">
                      <div></div>

                      <div class="lbl">Bold:</div>
                      <label class="chk"><input type="checkbox" id="wBold"> Bold</label>
                      <div></div>

                      <div class="lbl">Text color (fg):</div>
                      <input class="in" id="wFg" value="#ffffff" disabled="">
                      <button class="btn" id="pickFg">Pick…</button>

                      <div class="lbl">Background (bg):</div>
                      <input class="in" id="wBg" value="#00000000" disabled="">
                      <button class="btn" id="pickWBg">Pick…</button>

                      <div class="lbl">Checked (Checkbox only)</div>
                      <label class="chk"><input type="checkbox" id="wChecked"> Checked</label>
                      <div></div>
                    </div>
                  </div>
                </div>

              </div>
            </div>
          </div>
        </div>

      </div>

      <!-- RIGHT: Generated code preview -->
      <div class="rightArea">
        <div class="codeShell">
          <div class="codeTop">
            <div class="title">Auto-generated installer code</div>
            <div style="display:flex; gap:8px; align-items:center;">
              <span class="chip" id="lnChip">Line numbers: ON</span>
              <span class="chip">Live preview</span>
            </div>
          </div>

          <div class="codeArea" id="codeArea">
            <div class="codeRow" id="codeRow" style="grid-template-columns: 52px 1fr;">
              <div class="ln" id="ln" style="display: block;"> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
84
85
86
87
88
89
90
91
92
93
94
95
96
97
98
99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
115
116
117
118
119
120
121
122
123
124
125
126
127
128
129
130
131
132
133
134
135
136
137
138
139
140
141
142
143
144
145
146
147
148
149
150
151
152
153
154
155
156
157
158
159
160
161
162
163
164
165
166
167
168
169
170
171
172
173
174
175
176
177
178
179
180
181
182
183
184
185
186
187
188
189
190
191
192
193
194
195
196
197
198
199
200
201
202
203
204
205
206
207
208
209
210
211
212
213
214
215
216
217
218
219
220
221
222
223
224
225
226
227
228
229
230
231
232
233
234
235
236
237
238
239
240
241
242
243
244
245
246
247
248
249
250
251
252
253
254
255
256
257
258
259
260
261
262
263
264
265
266
267
268
269
270
271
272
273
274
275
276
277
278
279
280
281
282
283
284
285</div>
              <div class="code" id="code"># Auto-generated by Roxzned Setup Designer
# This is a standalone installer script. Compile it with PyInstaller if you want.
# Requires: PySide6

import os
import sys
import json
import zipfile
import traceback

from PySide6.QtCore import Qt, Signal, QThread
from PySide6.QtWidgets import (
    QApplication, QWizard, QWizardPage, QLabel, QLineEdit, QPushButton, QHBoxLayout,
    QVBoxLayout, QTextEdit, QCheckBox, QFileDialog, QMessageBox, QProgressBar, QWidget
)

PROJECT = {
  "app_name": "Vidplayer",
  "version": "2.0.9.1",
  "publisher": "sonic Fan Tech",
  "default_install_dir": "%LOCALAPPDATA%\\\\VidPlayer",
  "source_folder": "E:/Projects/Project USB/VS Code/Python/Roxzned Setup installer Designer/Source/data",
  "payload_zip": "E:/Projects/Project USB/VS Code/Python/Roxzned Setup installer Designer/Source/payload.zip",
  "license_text": "VidPlayer License Agreement\\nCopyright (c) 2023-2026 sonic Fan Tech / Axel613\\nVidPlayer is now source-available. This means:\\nYou may view and modify the source code for personal use and to add your own features.\\nYou must obtain permission from the original creator before:\\nRedistributing the source code or compiled binaries (modified or unmodified), or",
  "pages": [
    {
      "title": "Welcome",
      "role": "welcome",
      "bg": {
        "color": "#151515",
        "image": ""
      },
      "items": [
        {
          "type": "Label",
          "name": "lblTitle",
          "text": "Welcome to the Setup Wizard for Vidplayer v2.0.9.1",
          "x": 24,
          "y": 24,
          "w": 520,
          "h": 36,
          "extra": {
            "font_size": 10,
            "bold": false,
            "fg": "#ffffff",
            "bg": "#00000000"
          }
        },
        {
          "type": "Label",
          "name": "lblBody",
          "text": "This Setup Wizard will setup and install Vidplayer onto your computer, Press the next Button to start",
          "x": 24,
          "y": 74,
          "w": 680,
          "h": 50,
          "extra": {
            "font_size": 10,
            "bold": false,
            "fg": "#ffffff",
            "bg": "#00000000"
          }
        }
      ]
    },
    {
      "title": "License Agreement",
      "role": "license",
      "bg": {
        "color": "#151515",
        "image": ""
      },
      "items": [
        {
          "type": "Label",
          "name": "lblLic",
          "text": "Please read the license agreement below:",
          "x": 24,
          "y": 24,
          "w": 380,
          "h": 24,
          "extra": {
            "font_size": 10,
            "bold": true,
            "fg": "#ffffff",
            "bg": "#00000000"
          }
        },
        {
          "type": "Label",
          "name": "lblHint",
          "text": "(Demo) The real installer shows a scrollable license box here.",
          "x": 24,
          "y": 56,
          "w": 520,
          "h": 24,
          "extra": {
            "font_size": 10,
            "bold": false,
            "fg": "#cfcfcf",
            "bg": "#00000000"
          }
        },
        {
          "type": "CheckBox",
          "name": "chkAgree",
          "text": "I accept the agreement",
          "x": 24,
          "y": 98,
          "w": 260,
          "h": 20,
          "extra": {
            "font_size": 10,
            "bold": false,
            "fg": "#ffffff",
            "bg": "#00000000",
            "checked": false
          }
        }
      ]
    },
    {
      "title": "Choose Install Location",
      "role": "path",
      "bg": {
        "color": "#151515",
        "image": ""
      },
      "items": [
        {
          "type": "Label",
          "name": "lblPath",
          "text": "Choose where you want to install the program:",
          "x": 24,
          "y": 24,
          "w": 420,
          "h": 24,
          "extra": {
            "font_size": 10,
            "bold": true,
            "fg": "#ffffff",
            "bg": "#00000000"
          }
        },
        {
          "type": "EditBox",
          "name": "txtPath",
          "text": "%LOCALAPPDATA%\\VidPlayer",
          "x": 24,
          "y": 60,
          "w": 420,
          "h": 26,
          "extra": {
            "font_size": 10,
            "bold": false,
            "fg": "#ffffff",
            "bg": "#111111"
          }
        },
        {
          "type": "Button",
          "name": "btnSetPath",
          "text": "Set Path",
          "x": 454,
          "y": 60,
          "w": 92,
          "h": 26,
          "extra": {
            "font_size": 10,
            "bold": false,
            "fg": "#ffffff",
            "bg": "#232323"
          }
        },
        {
          "type": "CheckBox",
          "name": "chkDesktop",
          "text": "Make Desktop shortcut",
          "x": 59,
          "y": 98,
          "w": 220,
          "h": 20,
          "extra": {
            "font_size": 10,
            "bold": false,
            "fg": "#ffffff",
            "bg": "#00000000",
            "checked": true
          }
        }
      ]
    },
    {
      "title": "Installing",
      "role": "installing",
      "bg": {
        "color": "#151515",
        "image": ""
      },
      "items": [
        {
          "type": "Label",
          "name": "lblInst",
          "text": "Installing...",
          "x": 24,
          "y": 24,
          "w": 200,
          "h": 24,
          "extra": {
            "font_size": 10,
            "bold": true,
            "fg": "#ffffff",
            "bg": "#00000000"
          }
        },
        {
          "type": "Label",
          "name": "lblInst2",
          "text": "(Demo) Files will be packed + extracted here.",
          "x": 24,
          "y": 54,
          "w": 380,
          "h": 24,
          "extra": {
            "font_size": 10,
            "bold": false,
            "fg": "#cfcfcf",
            "bg": "#00000000"
          }
        }
      ]
    },
    {
      "title": "Finish",
      "role": "finish",
      "bg": {
        "color": "#151515",
        "image": ""
      },
      "items": [
        {
          "type": "Label",
          "name": "lblDone",
          "text": "Setup is complete.",
          "x": 24,
          "y": 24,
          "w": 220,
          "h": 24,
          "extra": {
            "font_size": 10,
            "bold": true,
            "fg": "#ffffff",
            "bg": "#00000000"
          }
        },
        {
          "type": "CheckBox",
          "name": "chkLaunch",
          "text": "Launch Vidplayer",
          "x": 24,
          "y": 60,
          "w": 200,
          "h": 20,
          "extra": {
            "font_size": 10,
            "bold": false,
            "fg": "#ffffff",
            "bg": "#00000000",
            "checked": true
          }
        }
      ]
    }
  ]
}

# (Demo) Real build will generate full UI + install/uninstall logic.
# • Pages: Welcome / License / Path / Installing / Finish
# • Widgets: Text, Button, CheckBox, Image, EditBox
# • Actions: Back/Next/Close/Open URL/Set Path
# • Packing: payload.zip -&gt; install dir

if __name__ == '__main__':
    print('Demo: generated script preview only')
</div>
            </div>
          </div>
        </div>
      </div>

    </div>

  </div>

  <!-- PyInstaller modal -->
  <div class="modalBack" id="modalBack" aria-hidden="true" style="display: none;">
    <div class="modal" role="dialog" aria-modal="true" aria-label="Build Installer with PyInstaller">
      <div class="modalTitle">
        <span>Build Installer with PyInstaller</span>
        <button class="btn" id="closeModalX" title="Close">✕</button>
      </div>
      <div class="modalBody">
        <div class="modalForm">
          <div class="lbl">Installer .py:</div>
          <input class="in" id="mInstaller" value="">
          <button class="btn" data-act="browseInstaller">Browse…</button>

          <div class="lbl">Output folder:</div>
          <input class="in" id="mOut" value="">
          <button class="btn" data-act="browseOut">Browse…</button>

          <div class="lbl">Icon (.ico):</div>
          <input class="in" id="mIcon" value="">
          <button class="btn" data-act="browseIcon">Browse…</button>

          <div class="lbl">Payload zip:</div>
          <input class="in" id="mPayload" value="E:/Projects/Project USB/VS Code/Python/Roxzned Setup installer Designer/Source/payload.zip">
          <button class="btn" data-act="browseMPayload">Browse…</button>
        </div>

        <div style="height:10px"></div>
        <label class="chk"><input type="checkbox" id="mAddData" checked=""> Bundle payload.zip into build (--add-data)</label>
        <label class="chk"><input type="checkbox" id="mOneFile" checked=""> One-file build (--onefile)</label>
        <label class="chk"><input type="checkbox" id="mNoConsole" checked=""> Windowed (no console) (--noconsole)</label>
        <label class="chk"><input type="checkbox" id="mClean" checked=""> Clean build (--clean)</label>

        <div class="logBox" id="buildLog">[Demo] Ready.\n\nClick Build to simulate a PyInstaller run.\n</div>
      </div>
      <div class="modalFooter">
        <button class="btn primary" id="doBuild">Build</button>
        <button class="btn" id="closeModal">Close</button>
      </div>
    </div>
  </div>

  <div class="toast" id="toast" style="display: none;"><b>Close</b> (demo) — press Back in your browser to leave.</div>

  <script>
    // -----------------------------
    // Demo state
    // -----------------------------
    const state = {
      showLineNumbers: true,
      zoom: 1,
      pages: [
        {
          title: "Welcome",
          role: "welcome",
          bgColor: "#151515",
          bgImage: "",
          widgets: [
            { id:"w1", type:"Label", name:"lblTitle", text:"Welcome to the Setup Wizard for Vidplayer v2.0.9.1", x:24, y:24, w:520, h:36, font:10, bold:false, fg:"#ffffff", bg:"#00000000" },
            { id:"w2", type:"Label", name:"lblBody", text:"This Setup Wizard will setup and install Vidplayer onto your computer, Press the next Button to start", x:24, y:74, w:680, h:50, font:10, bold:false, fg:"#ffffff", bg:"#00000000" },
          ]
        },
        {
          title: "License Agreement",
          role: "license",
          bgColor: "#151515",
          bgImage: "",
          widgets: [
            { id:"w3", type:"Label", name:"lblLic", text:"Please read the license agreement below:", x:24, y:24, w:380, h:24, font:10, bold:true, fg:"#ffffff", bg:"#00000000" },
            { id:"w4", type:"Label", name:"lblHint", text:"(Demo) The real installer shows a scrollable license box here.", x:24, y:56, w:520, h:24, font:10, bold:false, fg:"#cfcfcf", bg:"#00000000" },
            { id:"w5", type:"CheckBox", name:"chkAgree", text:"I accept the agreement", x:24, y:98, w:260, h:20, font:10, bold:false, fg:"#ffffff", bg:"#00000000", checked:false }
          ]
        },
        {
          title: "Choose Install Location",
          role: "path",
          bgColor: "#151515",
          bgImage: "",
          widgets: [
            { id:"w6", type:"Label", name:"lblPath", text:"Choose where you want to install the program:", x:24, y:24, w:420, h:24, font:10, bold:true, fg:"#ffffff", bg:"#00000000" },
            { id:"w7", type:"EditBox", name:"txtPath", text:"%LOCALAPPDATA%\\VidPlayer", x:24, y:60, w:420, h:26, font:10, bold:false, fg:"#ffffff", bg:"#111111" },
            { id:"w8", type:"Button", name:"btnSetPath", text:"Set Path", x:454, y:60, w:92, h:26, font:10, bold:false, fg:"#ffffff", bg:"#232323" },
            { id:"w9", type:"CheckBox", name:"chkDesktop", text:"Make Desktop shortcut", x:24, y:100, w:220, h:20, font:10, bold:false, fg:"#ffffff", bg:"#00000000", checked:true },
          ]
        },
        {
          title: "Installing",
          role: "installing",
          bgColor: "#151515",
          bgImage: "",
          widgets: [
            { id:"w10", type:"Label", name:"lblInst", text:"Installing...", x:24, y:24, w:200, h:24, font:10, bold:true, fg:"#ffffff", bg:"#00000000" },
            { id:"w11", type:"Label", name:"lblInst2", text:"(Demo) Files will be packed + extracted here.", x:24, y:54, w:380, h:24, font:10, bold:false, fg:"#cfcfcf", bg:"#00000000" }
          ]
        },
        {
          title: "Finish",
          role: "finish",
          bgColor: "#151515",
          bgImage: "",
          widgets: [
            { id:"w12", type:"Label", name:"lblDone", text:"Setup is complete.", x:24, y:24, w:220, h:24, font:10, bold:true, fg:"#ffffff", bg:"#00000000" },
            { id:"w13", type:"CheckBox", name:"chkLaunch", text:"Launch Vidplayer", x:24, y:60, w:200, h:20, font:10, bold:false, fg:"#ffffff", bg:"#00000000", checked:true }
          ]
        }
      ],
      selectedPageIndex: 0,
      selectedWidgetId: "w1",
    };

    // -----------------------------
    // Helpers
    // -----------------------------
    const $ = (id) => document.getElementById(id);

    function toast(msg){
      const t = $("toast");
      t.innerHTML = msg;
      t.style.display = "block";
      clearTimeout(toast._tm);
      toast._tm = setTimeout(()=> t.style.display = "none", 2200);
    }

    function clamp(n, a, b){ return Math.max(a, Math.min(b, n)); }

    function getPage(){ return state.pages[state.selectedPageIndex]; }
    function getWidget(){
      const p = getPage();
      return p.widgets.find(w => w.id === state.selectedWidgetId) || null;
    }

    function safeNum(v, fallback=0){
      const n = Number(v);
      return Number.isFinite(n) ? n : fallback;
    }

    // -----------------------------
    // Menus
    // -----------------------------
    const menus = Array.from(document.querySelectorAll('.menu'));

    function closeMenus(){ menus.forEach(m => m.classList.remove('open')); }

    menus.forEach(m => {
      m.addEventListener('click', (e)=>{
        e.stopPropagation();
        const was = m.classList.contains('open');
        closeMenus();
        if(!was) m.classList.add('open');
      });

      m.querySelectorAll('.dd-item').forEach(it => {
        it.addEventListener('click', (e)=>{
          e.stopPropagation();
          closeMenus();
          handleAction(it.dataset.act);
        });
      });
    });

    document.addEventListener('click', closeMenus);

    // -----------------------------
    // UI rendering
    // -----------------------------
    function renderPageList(){
      const list = $("pageList");
      list.innerHTML = "";
      state.pages.forEach((p, idx)=>{
        const el = document.createElement('div');
        el.className = 'pageItem' + (idx === state.selectedPageIndex ? ' active' : '');
        el.textContent = p.title;
        el.addEventListener('click', ()=>{
          state.selectedPageIndex = idx;
          // auto-select first widget if available
          const w0 = getPage().widgets[0];
          state.selectedWidgetId = w0 ? w0.id : null;
          syncPageFields();
          renderAll();
        });
        list.appendChild(el);
      });
    }

    function renderCanvas(){
      const canvas = $("canvas");
      canvas.classList.toggle('gridOn', $("showGrid").checked);
      canvas.style.backgroundColor = $("bgColor").value || '#151515';
      canvas.innerHTML = "";

      const p = getPage();
      p.widgets.forEach(w => {
        const el = document.createElement('div');
        el.className = 'widget' + (w.id === state.selectedWidgetId ? ' selected' : '');
        el.dataset.id = w.id;
        el.style.left = w.x + 'px';
        el.style.top  = w.y + 'px';
        el.style.width = w.w + 'px';
        el.style.height = w.h + 'px';
        el.style.fontSize = w.font + 'px';
        el.style.fontWeight = w.bold ? '700' : '400';
        el.style.color = w.fg || '#fff';

        if(w.type === 'Button') el.classList.add('btnW');
        if(w.type === 'Image') el.classList.add('imgW');

        // Background for widget if provided
        if(w.bg && w.bg !== '#00000000'){
          el.style.background = w.bg;
        }

        if(w.type === 'CheckBox'){
          el.style.cursor = 'pointer';
          el.innerHTML = `<label style="display:flex; align-items:center; gap:8px; cursor:pointer;">
              <input type="checkbox" ${w.checked ? 'checked' : ''} style="accent-color: var(--accent2);" />
              <span>${escapeHtml(w.text)}</span>
            </label>`;

          // checkbox toggle
          el.querySelector('input').addEventListener('click', (ev)=>{
            ev.stopPropagation();
            w.checked = ev.target.checked;
            if(state.selectedWidgetId === w.id){
              $("wChecked").checked = !!w.checked;
              updateCode();
            }
          });
        } else if (w.type === 'EditBox'){
          el.style.cursor = 'text';
          el.innerHTML = `<input value="${escapeAttr(w.text)}" style="width:100%; height:100%; background:#111; border:1px solid #3a3a3a; border-radius:4px; color:#f0f0f0; padding:4px 6px; font-family:var(--font); font-size:inherit;" />`;
          el.querySelector('input').addEventListener('input', (ev)=>{
            w.text = ev.target.value;
            if(state.selectedWidgetId === w.id){
              $("wText").value = w.text;
              updateCode();
            }
          });
        } else {
          el.textContent = w.text;
        }

        // select + drag
        el.addEventListener('mousedown', (ev)=>startDrag(ev, w, el));
        el.addEventListener('click', (ev)=>{
          ev.stopPropagation();
          selectWidget(w.id);
        });

        // button click action
        if(w.type === 'Button'){
          el.addEventListener('click', (ev)=>{
            ev.stopPropagation();
            if(w.name === 'btnSetPath'){
              toast('<b>Set Path</b> (demo): would open a folder picker in the real app.');
            } else {
              toast('<b>Button</b> clicked (demo).');
            }
          });
        }

        canvas.appendChild(el);
      });

      // Click empty space to deselect
      canvas.addEventListener('click', ()=>{
        state.selectedWidgetId = null;
        syncWidgetFields();
        renderCanvas();
        updateCode();
      }, { once:true });
    }

    function renderAll(){
      renderPageList();
      renderCanvas();
      syncWidgetFields();
      updateCode();
    }

    // -----------------------------
    // Dragging
    // -----------------------------
    let drag = null;

    function startDrag(ev, w, el){
      // if clicking inside input (EditBox), don't drag
      if(ev.target && ev.target.tagName === 'INPUT') return;
      ev.preventDefault();
      ev.stopPropagation();

      selectWidget(w.id);

      const canvas = $("canvas");
      const r = canvas.getBoundingClientRect();
      const startX = ev.clientX;
      const startY = ev.clientY;
      const ox = w.x;
      const oy = w.y;

      drag = { w, el, r, startX, startY, ox, oy };
      document.addEventListener('mousemove', onDrag);
      document.addEventListener('mouseup', endDrag);
    }

    function onDrag(ev){
      if(!drag) return;
      const { w, r, startX, startY, ox, oy } = drag;
      const dx = ev.clientX - startX;
      const dy = ev.clientY - startY;

      const nx = clamp(Math.round(ox + dx), 0, Math.max(0, Math.floor(r.width - 10)));
      const ny = clamp(Math.round(oy + dy), 0, Math.max(0, Math.floor(r.height - 10)));
      w.x = nx;
      w.y = ny;

      drag.el.style.left = nx + 'px';
      drag.el.style.top  = ny + 'px';

      $("wX").value = nx;
      $("wY").value = ny;
      updateCode(false);
    }

    function endDrag(){
      if(!drag) return;
      drag = null;
      document.removeEventListener('mousemove', onDrag);
      document.removeEventListener('mouseup', endDrag);
      updateCode();
    }

    // -----------------------------
    // Field syncing
    // -----------------------------
    function syncPageFields(){
      const p = getPage();
      $("pageTitle").value = p.title;
      $("pageRole").value  = p.role;
      $("bgColor").value   = p.bgColor;
      $("bgImage").value   = p.bgImage;
    }

    function selectWidget(id){
      state.selectedWidgetId = id;
      syncWidgetFields();
      renderCanvas();
      updateCode();
    }

    function syncWidgetFields(){
      const w = getWidget();
      const has = !!w;
      const ids = ["wType","wName","wText","wX","wY","wW","wH","wFont","wBold","wFg","wBg","wChecked"];
      ids.forEach(i => { if($(i)) $(i).disabled = !has && (i !== 'wBold' && i !== 'wChecked'); });

      if(!w){
        $("wType").value = "-";
        $("wName").value = "";
        $("wText").value = "";
        $("wX").value = 0;
        $("wY").value = 0;
        $("wW").value = 10;
        $("wH").value = 10;
        $("wFont").value = 10;
        $("wBold").checked = false;
        $("wFg").value = "#ffffff";
        $("wBg").value = "#00000000";
        $("wChecked").checked = false;
        return;
      }

      $("wType").value = w.type;
      $("wName").value = w.name || "";
      $("wText").value = w.text || "";
      $("wX").value = w.x;
      $("wY").value = w.y;
      $("wW").value = w.w;
      $("wH").value = w.h;
      $("wFont").value = w.font;
      $("wBold").checked = !!w.bold;
      $("wFg").value = w.fg || "#ffffff";
      $("wBg").value = w.bg || "#00000000";
      $("wChecked").checked = !!w.checked;
    }

    // -----------------------------
    // Code generation (demo)
    // -----------------------------
    function escapeAttr(s){
      return String(s).replace(/&/g,'&amp;').replace(/"/g,'&quot;').replace(/</g,'&lt;').replace(/>/g,'&gt;');
    }
    function escapeHtml(s){
      return String(s).replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;');
    }

    function buildProjectObject(){
      return {
        app_name: $("appName").value,
        version: $("appVer").value,
        publisher: $("publisher").value,
        default_install_dir: $("defaultDir").value,
        source_folder: $("sourceFolder").value,
        payload_zip: $("payloadZip").value,
        license_text: $("licenseText").value,
        pages: state.pages.map(p => ({
          title: p.title,
          role: p.role,
          bg: { color: p.bgColor, image: p.bgImage },
          items: p.widgets.map(w => {
            const base = {
              type: w.type,
              name: w.name,
              text: w.text,
              x: w.x, y: w.y, w: w.w, h: w.h,
              extra: { font_size: w.font, bold: !!w.bold, fg: w.fg, bg: w.bg }
            };
            if(w.type === 'CheckBox') base.extra.checked = !!w.checked;
            return base;
          })
        }))
      };
    }

    function toPythonCode(obj){
      // A compact, readable python-ish output for the demo.
      // (Not meant to be the full real generator.)
      const json = JSON.stringify(obj, null, 2);

      return `# Auto-generated by Roxzned Setup Designer\n# This is a standalone installer script. Compile it with PyInstaller if you want.\n# Requires: PySide6\n\nimport os\nimport sys\nimport json\nimport zipfile\nimport traceback\n\nfrom PySide6.QtCore import Qt, Signal, QThread\nfrom PySide6.QtWidgets import (\n    QApplication, QWizard, QWizardPage, QLabel, QLineEdit, QPushButton, QHBoxLayout,\n    QVBoxLayout, QTextEdit, QCheckBox, QFileDialog, QMessageBox, QProgressBar, QWidget\n)\n\nPROJECT = ${json}\n\n# (Demo) Real build will generate full UI + install/uninstall logic.\n# • Pages: Welcome / License / Path / Installing / Finish\n# • Widgets: Text, Button, CheckBox, Image, EditBox\n# • Actions: Back/Next/Close/Open URL/Set Path\n# • Packing: payload.zip -> install dir\n\nif __name__ == '__main__':\n    print('Demo: generated script preview only')\n`;
    }

    function updateCode(full=true){
      const py = toPythonCode(buildProjectObject());
      $("code").textContent = py;
      if(full){
        renderLineNumbers(py);
      }
    }

    function renderLineNumbers(text){
      const lines = text.split(/\n/);
      const ln = lines.map((_, i)=> String(i+1).padStart(2,' ') ).join('\n');
      $("ln").textContent = ln;
      $("ln").style.display = state.showLineNumbers ? 'block' : 'none';
      $("lnChip").textContent = 'Line numbers: ' + (state.showLineNumbers ? 'ON' : 'OFF');
      $("codeRow").style.gridTemplateColumns = state.showLineNumbers ? '52px 1fr' : '1fr';
    }

    // -----------------------------
    // Actions
    // -----------------------------
    function handleAction(act){
      switch(act){
        case 'build': openBuild(); break;
        case 'toggleWizard': toggleWizard(); break;
        case 'toggleDark': toggleDarkMode(); break;
        case 'toggleLineNumbers':
          state.showLineNumbers = !state.showLineNumbers;
          updateCode();
          toast(`<b>Line numbers</b> ${state.showLineNumbers ? 'enabled' : 'disabled'}.`);
          break;
        case 'toggleGrid':
          $("showGrid").checked = !$("showGrid").checked;
          renderCanvas();
          toast(`<b>Grid</b> ${$("showGrid").checked ? 'enabled' : 'disabled'}.`);
          break;
        case 'zoomIn': setZoom(state.zoom + 0.08); break;
        case 'zoomOut': setZoom(state.zoom - 0.08); break;
        case 'resetZoom': setZoom(1); break;
        case 'newProject': toast('<b>New Project</b> (demo) — would reset all fields.'); break;
        case 'openProject': toast('<b>Open Project</b> (demo) — would open a .json project file.'); break;
        case 'saveProject': toast('<b>Save Project</b> (demo) — would save current project.'); break;
        case 'exportInstaller': toast('<b>Export Installer</b> (demo) — would export generated installer .py.'); break;
        case 'exportUninstaller': toast('<b>Export Uninstaller</b> (demo) — would export uninstaller .py.'); break;
        case 'close': toast('<b>Close</b> (demo) — press Back in your browser to leave.'); break;
        case 'undo': toast('<b>Undo</b> (demo).'); break;
        case 'redo': toast('<b>Redo</b> (demo).'); break;
        case 'addWidget': addWidgetPrompt(); break;
        case 'deleteWidget': deleteSelectedWidget(); break;
        case 'help': toast('<b>Help</b> (demo) — the real app opens a full help doc.'); break;
        case 'about': toast('<b>Roxzned Setup Designer</b> — web demo mockup.'); break;
        default:
          toast('<b>Action</b> not wired: ' + act);
      }
    }

    function setZoom(z){
      state.zoom = clamp(z, 0.75, 1.25);
      $("appRoot").style.transform = `scale(${state.zoom})`;
      $("appRoot").style.transformOrigin = 'top left';
      // keep scroll workable
      document.body.style.height = (100/state.zoom) + 'vh';
      toast(`<b>Zoom</b> ${Math.round(state.zoom*100)}%`);
    }

    function toggleWizard(){
      document.body.classList.toggle('wizardHidden');
      toast('<b>Toggle Wizard Maker</b> — ' + (document.body.classList.contains('wizardHidden') ? 'Code-only view' : 'Designer + code view'));
    }

    function toggleDarkMode(){
      document.body.classList.toggle('lightMode');
      toast('<b>Toggle Dark Mode</b> — ' + (document.body.classList.contains('lightMode') ? 'Light mode (demo)' : 'Dark mode'));
    }

    // -----------------------------
    // Page ops
    // -----------------------------
    function addPage(){
      const name = prompt('New page name:', 'New Page');
      if(!name) return;
      state.pages.push({ title:name, role:'custom', bgColor:'#151515', bgImage:'', widgets:[] });
      state.selectedPageIndex = state.pages.length - 1;
      state.selectedWidgetId = null;
      syncPageFields();
      renderAll();
      toast('<b>Page</b> added: ' + escapeHtml(name));
    }

    function dupPage(){
      const p = getPage();
      const copy = JSON.parse(JSON.stringify(p));
      copy.title = p.title + ' (Copy)';
      // ensure ids unique
      copy.widgets.forEach(w => w.id = w.id + '_c' + Math.floor(Math.random()*9999));
      state.pages.splice(state.selectedPageIndex+1, 0, copy);
      state.selectedPageIndex += 1;
      state.selectedWidgetId = copy.widgets[0]?.id || null;
      syncPageFields();
      renderAll();
      toast('<b>Page</b> duplicated.');
    }

    function delPage(){
      if(state.pages.length <= 1){ toast('Can\'t delete the last page.'); return; }
      const p = getPage();
      if(!confirm('Delete page "' + p.title + '"?')) return;
      state.pages.splice(state.selectedPageIndex, 1);
      state.selectedPageIndex = clamp(state.selectedPageIndex, 0, state.pages.length-1);
      state.selectedWidgetId = getPage().widgets[0]?.id || null;
      syncPageFields();
      renderAll();
      toast('<b>Page</b> deleted.');
    }

    function movePage(dir){
      const i = state.selectedPageIndex;
      const j = i + dir;
      if(j < 0 || j >= state.pages.length) return;
      const tmp = state.pages[i];
      state.pages[i] = state.pages[j];
      state.pages[j] = tmp;
      state.selectedPageIndex = j;
      syncPageFields();
      renderAll();
    }

    // -----------------------------
    // Widget ops
    // -----------------------------
    function addWidgetPrompt(){
      const type = prompt('Widget type: Label, Button, CheckBox, Image, EditBox', 'Label');
      if(!type) return;
      const t = type.trim();
      const p = getPage();
      const id = 'w' + Math.floor(Math.random()*100000);
      const w = {
        id,
        type: t,
        name: t.toLowerCase() + '_' + id,
        text: t === 'Button' ? 'Button' : (t === 'CheckBox' ? 'Checkbox' : (t === 'EditBox' ? '%LOCALAPPDATA%\\App' : 'Label')),
        x: 24, y: 140,
        w: t === 'Button' ? 92 : (t === 'EditBox' ? 280 : 320),
        h: t === 'EditBox' ? 26 : (t === 'Button' ? 26 : 24),
        font: 10,
        bold: false,
        fg: '#ffffff',
        bg: t === 'EditBox' ? '#111111' : '#00000000'
      };
      if(t === 'CheckBox') w.checked = false;
      p.widgets.push(w);
      state.selectedWidgetId = w.id;
      renderAll();
      toast('<b>Widget</b> added: ' + escapeHtml(t));
    }

    function deleteSelectedWidget(){
      const w = getWidget();
      if(!w){ toast('No widget selected.'); return; }
      const p = getPage();
      const idx = p.widgets.findIndex(x=>x.id===w.id);
      if(idx >= 0) p.widgets.splice(idx, 1);
      state.selectedWidgetId = p.widgets[0]?.id || null;
      renderAll();
      toast('<b>Widget</b> deleted.');
    }

    // -----------------------------
    // Build modal
    // -----------------------------
    function openBuild(){
      $("modalBack").style.display = 'flex';
      $("modalBack").setAttribute('aria-hidden','false');
      toast('<b>Build</b> window opened.');
    }

    function closeBuild(){
      $("modalBack").style.display = 'none';
      $("modalBack").setAttribute('aria-hidden','true');
    }

    $("closeModal").addEventListener('click', closeBuild);
    $("closeModalX").addEventListener('click', closeBuild);
    $("modalBack").addEventListener('click', (e)=>{
      if(e.target.id === 'modalBack') closeBuild();
    });

    $("doBuild").addEventListener('click', ()=>{
      const log = $("buildLog");
      log.textContent = "[Demo] Starting PyInstaller…\n";
      const steps = [
        "Collecting modules…",
        "Analyzing dependencies…",
        "Bundling payload.zip (--add-data)…",
        "Building onefile (--onefile)…",
        "Finalizing EXE…",
        "Done! (demo)"
      ];
      let i = 0;
      const tm = setInterval(()=>{
        log.textContent += steps[i] + "\n";
        log.scrollTop = log.scrollHeight;
        i++;
        if(i >= steps.length){ clearInterval(tm); }
      }, 320);
    });

    $("buildBtn").addEventListener('click', openBuild);
    $("buildLink").addEventListener('click', openBuild);

    // -----------------------------
    // Wiring form inputs
    // -----------------------------
    function wireInputs(){
      // Project fields -> code update
      ["appName","appVer","publisher","defaultDir","sourceFolder","payloadZip","licenseText"].forEach(id=>{
        $(id).addEventListener('input', ()=> updateCode());
      });

      // Page fields
      $("pageTitle").addEventListener('input', ()=>{
        getPage().title = $("pageTitle").value;
        renderPageList();
        updateCode();
      });
      $("pageRole").addEventListener('change', ()=>{ getPage().role = $("pageRole").value; updateCode(); });
      $("bgColor").addEventListener('input', ()=>{ getPage().bgColor = $("bgColor").value; renderCanvas(); updateCode(); });
      $("bgImage").addEventListener('input', ()=>{ getPage().bgImage = $("bgImage").value; updateCode(); });

      $("showGrid").addEventListener('change', ()=>{ renderCanvas(); updateCode(); });

      // Widget props
      function bindWidgetProp(id, fn){ $(id).addEventListener('input', fn); $(id).addEventListener('change', fn); }

      bindWidgetProp('wName', ()=>{ const w=getWidget(); if(!w) return; w.name=$("wName").value; updateCode(); });
      bindWidgetProp('wText', ()=>{
        const w=getWidget(); if(!w) return;
        w.text=$("wText").value;
        renderCanvas();
        updateCode();
      });
      bindWidgetProp('wX', ()=>{ const w=getWidget(); if(!w) return; w.x=safeNum($("wX").value,w.x); renderCanvas(); updateCode(false); });
      bindWidgetProp('wY', ()=>{ const w=getWidget(); if(!w) return; w.y=safeNum($("wY").value,w.y); renderCanvas(); updateCode(false); });
      bindWidgetProp('wW', ()=>{ const w=getWidget(); if(!w) return; w.w=safeNum($("wW").value,w.w); renderCanvas(); updateCode(false); });
      bindWidgetProp('wH', ()=>{ const w=getWidget(); if(!w) return; w.h=safeNum($("wH").value,w.h); renderCanvas(); updateCode(false); });
      bindWidgetProp('wFont', ()=>{ const w=getWidget(); if(!w) return; w.font=safeNum($("wFont").value,w.font); renderCanvas(); updateCode(false); });
      $("wBold").addEventListener('change', ()=>{ const w=getWidget(); if(!w) return; w.bold=$("wBold").checked; renderCanvas(); updateCode(); });
      bindWidgetProp('wFg', ()=>{ const w=getWidget(); if(!w) return; w.fg=$("wFg").value; renderCanvas(); updateCode(false); });
      bindWidgetProp('wBg', ()=>{ const w=getWidget(); if(!w) return; w.bg=$("wBg").value; renderCanvas(); updateCode(false); });
      $("wChecked").addEventListener('change', ()=>{ const w=getWidget(); if(!w) return; w.checked=$("wChecked").checked; renderCanvas(); updateCode(); });

      // Buttons that act like Browse…
      document.querySelectorAll('[data-act]').forEach(b => {
        // already wired menu items; this is for buttons
        if(b.classList.contains('dd-item')) return;
        b.addEventListener('click', ()=>{
          const a = b.dataset.act;
          switch(a){
            case 'browseSource': toast('<b>Browse</b> (demo) — would pick a source folder.'); break;
            case 'browsePayload': toast('<b>Browse</b> (demo) — would pick payload.zip.'); break;
            case 'browseBg': toast('<b>Browse</b> (demo) — would pick a background image.'); break;
            default: toast('<b>Button</b> (demo): ' + a);
          }
        });
      });

      // Page buttons
      document.querySelector('[data-act="addPage"]').addEventListener('click', addPage);
      document.querySelector('[data-act="dupPage"]').addEventListener('click', dupPage);
      document.querySelector('[data-act="delPage"]').addEventListener('click', delPage);
      document.querySelector('[data-act="upPage"]').addEventListener('click', ()=>movePage(-1));
      document.querySelector('[data-act="downPage"]').addEventListener('click', ()=>movePage(1));

      // Color pickers (use hidden input[type=color])
      hookColorPicker($("pickBg"), $("bgColor"), (v)=>{ getPage().bgColor = v; renderCanvas(); updateCode(); });
      hookColorPicker($("pickFg"), $("wFg"), (v)=>{ const w=getWidget(); if(!w) return; w.fg=v; renderCanvas(); updateCode(false); });
      hookColorPicker($("pickWBg"), $("wBg"), (v)=>{ const w=getWidget(); if(!w) return; w.bg=v; renderCanvas(); updateCode(false); });

      // Keyboard shortcuts (demo)
      document.addEventListener('keydown', (e)=>{
        if(e.key === 'Escape'){ closeMenus(); closeBuild(); }
        const ctrl = e.ctrlKey || e.metaKey;
        if(!ctrl) return;
        if(e.key.toLowerCase() === 'b'){ e.preventDefault(); openBuild(); }
        if(e.key.toLowerCase() === 'w'){ e.preventDefault(); toggleWizard(); }
        if(e.key.toLowerCase() === 'd'){ e.preventDefault(); toggleDarkMode(); }
        if(e.key.toLowerCase() === 'l'){ e.preventDefault(); handleAction('toggleLineNumbers'); }
        if(e.key.toLowerCase() === 'g'){ e.preventDefault(); handleAction('toggleGrid'); }
        if(e.key === '0'){ e.preventDefault(); handleAction('resetZoom'); }
        if(e.key === '=' || e.key === '+'){ e.preventDefault(); handleAction('zoomIn'); }
        if(e.key === '-'){ e.preventDefault(); handleAction('zoomOut'); }
      });
    }

    function hookColorPicker(button, input, onPick){
      const c = document.createElement('input');
      c.type = 'color';
      c.style.position = 'fixed';
      c.style.left = '-9999px';
      document.body.appendChild(c);

      button.addEventListener('click', ()=>{
        // best-effort: if value is hex, set it
        const v = input.value.trim();
        if(/^#[0-9a-fA-F]{6}$/.test(v)) c.value = v;
        c.click();
      });

      c.addEventListener('input', ()=>{
        input.value = c.value;
        onPick(c.value);
      });
    }

    // -----------------------------
    // Init
    // -----------------------------
    function init(){
      // default page fields
      syncPageFields();
      renderAll();
      wireInputs();
      toast('<b>Web Demo</b> loaded — click around and drag elements!');
    }

    init();
  </script><input type="color" style="position: fixed; left: -9999px;"><input type="color" style="position: fixed; left: -9999px;"><input type="color" style="position: fixed; left: -9999px;">


EOF</body></html>
